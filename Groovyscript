

pipeline { 
    agent any 
  
    stages { 
        stage('Checkout') { 
            steps { 
                git 'https://github.com/sugamQA/OpenCart-API' 
            } 
        } 
  
        stage('Install Dependencies') { 
            steps { 
                bat 'npm install' 
                bat 'npm install -D allure-playwright' 
                bat 'npm install -g allure-commandline --force' 
            } 
        } 
  
        stage('Run Tests') { 
            steps { 
                bat 'npx playwright install' 
                //bat 'npx playwright test --grep=@master' 
                bat 'npm run "%script%"' 
                
                 
            } 
        } 
  
        stage('Generate Allure Report') { 
            steps { 
                bat 'allure generate ./allure-results --clean -o ./allure-report' 
            } 
        } 
    } 
  
    post { 
        always { 
            // Archive test results (if any) 
            archiveArtifacts artifacts: 'test-results/**/*', allowEmptyArchive: 
true 
  
            // Publish Allure results (if plugin is installed) 
            allure includeProperties: false, 
                   jdk: '', 
                   results: [[path: 'allure-results']] 
        } 
    } 
} 
